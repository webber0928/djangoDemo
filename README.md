# djangoDemo
django demo

## Info

```
Python 3.9.0
django 4.2.7
```


## Install

```
$ python -m pip install Django
```

## Start

Creating a project
```
$ django-admin startproject myWeb

myWeb/
    manage.py
    myWeb/
        __init__.py
        settings.py
        urls.py
        asgi.py
        wsgi.py
```

啟動
```
$ cd myWeb
$ python manage.py runserver

#更換 port
python manage.py runserver 0.0.0.0:8000
```

建立新項目
```
$ python manage.py startapp polls

polls/
    __init__.py
    admin.py
    apps.py
    migrations/
        __init__.py
    models.py
    tests.py
    views.py
```

TIME_ZONE
```
# settings.py
TIME_ZONE = 'Asia/Taipei'
```

資料庫配置
```
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}

$ python manage.py migrate

#  migrate 命令根據 INSTALLED_APPS 配置
```

建立 polls 資料庫
```
# settings.py
INSTALLED_APPS = [
    "polls.apps.PollsConfig",
    .
    .
    .
]

# 建立 migrations data
$ python manage.py makemigrations polls

# add polls/migrations/0001_initial.py
```

查看 SQL
```
$ python manage.py sqlmigrate polls 0001

BEGIN;
--
-- Create model Question
--
CREATE TABLE "polls_question" (
    "id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "question_text" varchar(200) NOT NULL,
    "pub_date" timestamp with time zone NOT NULL
);
--
-- Create model Choice
--
CREATE TABLE "polls_choice" (
    "id" bigint NOT NULL PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    "choice_text" varchar(200) NOT NULL,
    "votes" integer NOT NULL,
    "question_id" bigint NOT NULL
);
ALTER TABLE "polls_choice"
  ADD CONSTRAINT "polls_choice_question_id_c5b4b260_fk_polls_question_id"
    FOREIGN KEY ("question_id")
    REFERENCES "polls_question" ("id")
    DEFERRABLE INITIALLY DEFERRED;
CREATE INDEX "polls_choice_question_id_c5b4b260" ON "polls_choice" ("question_id");

COMMIT;
```

建立資料表
```
$ python manage.py migrate
```

shell api
```
$ python manage.py shell
```

```
>>> from polls.models import Choice, Question  # Import the model classes we just wrote.

# No questions are in the system yet.
>>> Question.objects.all()
<QuerySet []>

# Create a new Question.
# Support for time zones is enabled in the default settings file, so
# Django expects a datetime with tzinfo for pub_date. Use timezone.now()
# instead of datetime.datetime.now() and it will do the right thing.
>>> from django.utils import timezone
>>> q = Question(question_text="What's new?", pub_date=timezone.now())

# Save the object into the database. You have to call save() explicitly.
>>> q.save()

# Now it has an ID.
>>> q.id
1

# Access model field values via Python attributes.
>>> q.question_text
"What's new?"
>>> q.pub_date
datetime.datetime(2012, 2, 26, 13, 0, 0, 775217, tzinfo=datetime.timezone.utc)

# Change values by changing the attributes, then calling save().
>>> q.question_text = "What's up?"
>>> q.save()

# objects.all() displays all the questions in the database.
>>> Question.objects.all()
<QuerySet [<Question: Question object (1)>]>
```

建立管理帳號
```
$ python manage.py createsuperuser

Username: admin
Email address: admin@gmail.com
Password: 0000
Password (again): 0000
```

## 虛擬環境

建立一個虛擬環境：
```
python3 -m venv ~/.virtualenvs/djangodev
```

啟動它:
```
source ~/.virtualenvs/djangodev/bin/activate
```